<!doctype html>
<html lang="en">
    <head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		
        <title>Joe O'Connor</title>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
		<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
		
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
		
		<link href="https://fonts.googleapis.com/css?family=Noto+Sans|Roboto" rel="stylesheet">
		
		<link rel="stylesheet" href="style.css">
		<script>
		const monthNames = ["January", "February", "March", "April", "May", "June",
				"July", "August", "September", "October", "November", "December"
			];
		</script>
		<!-- Project loading scripts -->
		<script>
			class ProjectControl {
				constructor(type, name, text, default_value, data={}) {
					this.type = type;
					this.name = name;
					this.text = text;
					this.default_value = default_value;
					this.data = data;
				}
				
				static fromJson(jsonData) {
				
				}
			}
			
			class Project {
				constructor(name, js_urls, date_month, date_year, controls) {
					this.name = name;
					this.js_urls = js_urls;
					this.date_month = date_month;
					this.date_year = date_year;
					this.controls = controls;
				}
				
				static fromJson(jsonData) {
					return new Project(jsonData["name"], jsonData["js_urls"], jsonData["date_month"], jsonData["date_year"], []);
				}
			}
		
			let projectsData;
			let currentProject;
			
			let tickFunction = null;
			let initFunction;
			
			let currentProjectLoop = null;
			
			let canvasElement;
			let canvas = null;
			
			function initCanvas() {
				// Get canvas to draw to
				canvasElement = document.getElementById("backgroundCanvas");
				canvas = canvasElement.getContext("2d");
			}
			
			function initProject() {
				// Init canvas if it needs initing
				if (canvas === null) {
					initCanvas();
				}
				
				stopProject();
				
				// Init the new project
				initFunction(canvas, canvasElement.width, canvasElement.height);
			}
			
			function tickProject(ticks) {
				if(tickFunction != null) {
					tickFunction(ticks);
				}
			}
			
			function stopProject() {
				// Stop the last project's loop
				if (currentProjectLoop != null) {
					clearInterval(currentProjectLoop)
					currentProjectLoop = null;
				}
			}
			
			function playProject() {
				stopProject();
				
				// Animate info bar in
				slideInProjectInfo();
				
				// Add loop
				window.setInterval(tickProject, 50, 50);
			}
			
			function getProjectsData() {
				$.ajax({
					dataType: "json",
					url: "projects.json",
					success: getProjectsDataSuccess,
					error: getProjectsDataError
				});
			}
			
			function getProjectsDataError( jqXHR, textStatus, errorThrown ) {
				alert("Could not load projects: " + textStatus + "\n" + errorThrown);
			}
			
			function getProjectsDataSuccess(data) {
				projectsData = data;
				
				if (projectsData == null) {
					alert("Could not parse json data");
				}
				
				loadProject(0);
			}
			
			function loadProject(index) {
				stopProject();
			
				let projectData = projectsData["projects"][0];
				currentProject = Project.fromJson(projectData);
				
				displayProjectInfo();
				
				// Load js for project
				scriptsDiv = $("#project-scripts");
				scriptsDiv.empty(); // Clear out all old code
				for (let x = 0; x < currentProject.js_urls.length; x++) {
					let newScript = document.createElement('script');
					newScript.src = currentProject.js_urls[x];
					scriptsDiv.append(newScript);
				}
				
				initProject();
			}
			
			function displayProjectInfo() {
				let name = "";
				let date = "";
				if (currentProject != null) {
					name = currentProject.name;
					date = monthNames[currentProject.date_month] + " " + currentProject.date_year;
				}
				$("#project-name").text(name);
				$("#project-date").text(date);
			}
		</script>
		
		<!-- Display animation scripts -->
		<script>
			// Constants for inflation when the user hovers over the footer logos
			const footer_hover_inflation_ratio = 1.3;
			const footer_hover_inflation_speed = 300;
			
			// Used to decrease jquery commands
			let icons;
			let name_title;
		
			function animationsonload() {
				// Make inflatables
				$(".inflatable").each(function(index) {
					this.inflatable = new Inflatable(this);
					this.onmouseover = () => { this.inflatable.inflate(footer_hover_inflation_ratio, footer_hover_inflation_speed); };
					this.onmouseleave = () => { this.inflatable.deflate(footer_hover_inflation_speed); };
				});
				
				// Query everything
				icons = $("#icons");
				name_title = $("#name-title");
			
				// Hide everything
				name_title.hide();
				icons.hide();
				
				// Set the title to occupy the centre of the screen
				name_title.css({"position": "relative",
					"top": ((window.innerHeight - name_title.height()) / 2) + "px",
					"left": ((window.innerWidth - name_title.width()) / 2) + "px"});
			
			    // Fade in the title
				name_title.toggle("fade", 1000, afterTitleFaded);
				
			}
			
			function afterTitleFaded() {
				// Slide the title to the side
				name_title.animate({left: 0}, 1000, afterTitleLeft);
			}
			
			function afterTitleLeft() {
				// Slide the title up
				name_title.animate({top: 0}, 1000, afterAnimations);
			
				// Slide in the icons at the footer
				icons.effect("slide", {direction: "down"}, 1000);
			}
			
			function afterAnimations() {
				playProject();
			}
			
			function slideInProjectInfo() {
				let projecctInfo = $("#project-info-bar");
				projecctInfo.hide();
				projecctInfo.toggle("fade", 4000);
			}
			
			let inflatables = {};
				
			class Inflatable {
				constructor(o) {
				    // Assign values
					this.initial_width = o.width;
					this.src_obj = $(o);
					
					// Register this as an inflatable
					inflatables[o] = this;
				}
				
				inflate(scale, speed) {
					this.src_obj.stop();
					this.src_obj.animate({width: this.initial_width * scale}, speed);
				}
				
				deflate(speed) {
					this.src_obj.stop();
					this.src_obj.animate({width: this.initial_width}, speed);
				}
			}
		</script>
    </head>
    <body onload="animationsonload(); getProjectsData();">
		<div class="container-fluid">
			<div class="row">
				<div class="col-auto">
					<div class="title" id="name-title">
						Joe O'Connor
					</div>
				</div>
			</div>
		</div>
		
		<!-- Canvas -->
		<canvas class="top-left background square-height" width="4000" height="4000" id="backgroundCanvas"></canvas>
		
		<!-- Footer of the page -->
		<div class="footer">
			<!-- Current Project Info -->
			<div class="bottom-left project-info" id="project-info-bar", style="display: none;">
				<div class="container-fluid">
					<div class="row">
						<div class="col-auto" id="project-name">
						</div>
						<div class="col-auto" id="project-date">
						</div>
					</div>
				</div>
			</div>
			<!-- Icons -->
			<div class="bottom-right" id="icons">
				<a href="https://github.com/Joeoc2001">
					<img src="GitHub-Mark-64px.png" class="footer-image inflatable" onload="" onmouseover="" onmouseleave=""/>
				</a>
			</div>
		</div>
		
		<div id="project-scripts">
		</div>
    </body>
</html>